

    <Window x:Class="UI.QueryBuilder"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:toolkit="clr-namespace:Microsoft.Windows.Controls;assembly=WPFToolkit"
    xmlns:Custom="clr-namespace:UI.Controls"
    xmlns:enums="clr-namespace:Analytics.Data.Enums;assembly=Analytics"
    xmlns:data="clr-namespace:Analytics.Data;assembly=Analytics"
    SizeToContent="WidthAndHeight" WindowStyle="SingleBorderWindow" AllowsTransparency="False"   
    WindowStartupLocation="CenterScreen" ShowInTaskbar="True" ResizeMode="CanMinimize"  
        Title="QueryBuilder"  Background="LightGray" 
        MouseEnter="Window_MouseEnter"
    >
    
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/PresentationFramework.Royale;V3.0.0.0;31bf3856ad364e35;component\themes\royale.normalcolor.xaml" />
            </ResourceDictionary.MergedDictionaries>
            
            <DataTemplate x:Key="listbTemplate">
                <TextBlock Margin="0,5,0,0" Text="{Binding Key}" />
            </DataTemplate>

            <DataTemplate x:Key="filterChooserTemplate"  >
                <StackPanel Orientation="Horizontal" >
                    <ComboBox Panel.ZIndex="-1" HorizontalAlignment="Right" SelectionChanged="logOPBox_SelectionChanged" VerticalAlignment="Bottom" x:Name="logOPBox"  Width="50" Height="20" >
                        <ComboBoxItem>
                            <enums:LogicalOperator>And</enums:LogicalOperator>
                        </ComboBoxItem>
                        <ComboBoxItem>
                            <enums:LogicalOperator>Or</enums:LogicalOperator>
                        </ComboBoxItem>
                    </ComboBox>
                    <TextBlock Margin="5,0,0,0" VerticalAlignment="Bottom" Text="{Binding Path=SimplifiedString}" Height="20" TextWrapping="Wrap" />
                </StackPanel>
                
                <DataTemplate.Triggers>
                    <DataTrigger Binding="{Binding Path=LOperator}" >
                        <DataTrigger.Value>
                                <enums:LogicalOperator>None</enums:LogicalOperator>
                        </DataTrigger.Value>
                        <Setter TargetName="logOPBox" Property="Visibility" Value="Collapsed" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding Path=LOperator}" >
                        <DataTrigger.Value>
                            <enums:LogicalOperator>And</enums:LogicalOperator>
                        </DataTrigger.Value>
                        <Setter TargetName="logOPBox" Property="SelectedIndex" Value="0" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding Path=LOperator}" >
                        <DataTrigger.Value>
                            <enums:LogicalOperator>Or</enums:LogicalOperator>
                        </DataTrigger.Value>
                        <Setter TargetName="logOPBox" Property="SelectedIndex" Value="1" />
                    </DataTrigger>
                </DataTemplate.Triggers>
            </DataTemplate>

            <DataTemplate x:Key="combSizeTemplate">
                <ContentPresenter Content="{Binding Key}" Tag="{Binding Value}" />
            </DataTemplate>
            
            <DataTemplate x:Key="comboOperatorTemplate">
                <ContentPresenter Content="{Binding Key}" Tag="{Binding Value}" />
            </DataTemplate>
            
            <DataTemplate x:Key="defaultString">
                <TextBlock Text="{Binding}" TextWrapping="Wrap" Height="auto" />
            </DataTemplate>
            
            <LinearGradientBrush x:Key="sizeBorderBrush">
                <GradientStop Color="Black" Offset="0.5" />
                <GradientStop Color="White" Offset="1.0" />
            </LinearGradientBrush>
              
        </ResourceDictionary>
    
    </Window.Resources>
    
    <Canvas x:Name="MainCanvas" Height="566" Width="578">
        
    <Label Content="Profile:" Canvas.Left="12" Canvas.Top="11.684" Height="28.453" Name="label6" Width="45"/>
    <ComboBox  SelectionChanged="comboBoxSites_SelectionChanged" ItemsSource="{Binding}" Canvas.Left="12" Canvas.Top="35" Height="20" Name="comboBoxSites" Width="157" >
        <ComboBox.ItemTemplate>
            <DataTemplate>
                <ContentPresenter Content="{Binding Title}" Tag="{Binding ProfileId}" />
            </DataTemplate>                    
        </ComboBox.ItemTemplate>
    </ComboBox>
    
    <Label Content="Start date"  Canvas.Left="181" Canvas.Top="12" Width="58" />
    <toolkit:Calendar x:Name="startDateCalendar"  Canvas.Left="181" Canvas.Top="31" />
    <Label Content="End date"  Canvas.Left="382" Canvas.Top="12" Width="53" />
    <toolkit:Calendar x:Name="endDateCalendar"  Canvas.Left="382" Canvas.Top="31" />

    <Expander Canvas.Left="15" Canvas.Top="217" Panel.ZIndex="1"  Margin="0" Cursor="Hand" Collapsed="DimensionsExpander_Collapsed" x:Name="DimensionsExpander" ExpandDirection="Down" Expanded="DimensionsExpander_Expanded" >
        <Custom:CustomTreeView Cursor="Arrow" Panel.ZIndex="1" Margin="0,5,0,0" ItemsDataType="Dimension" x:Name="DimensionsView"  />
            <Expander.Header>
                <Button Width="100" HorizontalContentAlignment="Center" Click="Expand" Content="Dimension" />
            </Expander.Header>
        </Expander>
        
    <Expander Panel.ZIndex="1" Padding="0" Canvas.Left="162" Canvas.Top="217"  Cursor="Hand"   ExpandDirection="Down" Collapsed="MetricsExpander_Collapsed"   x:Name="MetricsExpander" IsExpanded="False" Expanded="MetricsExpander_Expanded" Grid.IsSharedSizeScope="False" OverridesDefaultStyle="False" >
        <Custom:CustomTreeView Margin="-147,5,0,0" Cursor="Arrow"  Panel.ZIndex="1"  ItemsDataType="Metric" x:Name="MetricsView" />
            <Expander.Header>
                <Button Width="100" HorizontalContentAlignment="Center" Click="Expand" Content="Metrics" />
            </Expander.Header>
        </Expander>
    <Expander Panel.ZIndex="1"  Canvas.Left="311" Canvas.Top="217" Collapsed="FilterExpander_Collapsed" Cursor="Hand"  x:Name="FilterExpander" Expanded="FilterExpander_Expanded" ExpandDirection="Down" IsExpanded="False" Height="24.277" Width="127">
        <Canvas Background="White" Panel.ZIndex="1" FocusManager.FocusedElement="{Binding ElementName=addFilter}" x:Name="FilterCanvas" Margin="-297,5,0,0" Width="539.946" Height="263.75">
            <Label Content="Operator" Canvas.Left="176" Canvas.Top="46"  Width="52" />
            <ComboBox ItemTemplate="{StaticResource comboOperatorTemplate}" x:Name="comboBoxOperator" Width="134" Canvas.Left="180" Canvas.Top="64.408" Height="21.109" />
            <Label Content="Expression" Canvas.Left="332" Canvas.Top="44"  Width="62" />
            <TextBox Focusable="True" x:Name="textBoxExpression" Width="156" Canvas.Left="336" Canvas.Top="67" />    
            <Button x:Name="addFilter" Click="addFilter_Click" Canvas.Left="431" Canvas.Top="112" Content="Add" Height="26" Width="60" />
            <Button x:Name="removeFilter" Click="removeFilter_Click" Canvas.Left="335" Canvas.Top="113" Content="Remove" Height="26" Width="60" />
            <ListBox ItemTemplate="{StaticResource filterChooserTemplate}" x:Name="filterBox" Canvas.Left="60" Canvas.Top="151" BorderBrush="Black" Width="431" Height="91" BorderThickness="1"/>
            <ComboBox DropDownOpened="comboBoxMetrics_DropDownOpened" SelectionChanged="comboBoxMetrics_SelectionChanged" ItemTemplate="{StaticResource combSizeTemplate}" Canvas.Left="60" Canvas.Top="91.072"  x:Name="comboBoxMetrics" Width="98" Height="21.109" />
            <ComboBox DropDownOpened="comboBoxDimensions_DropDownOpened" SelectionChanged="comboBoxDimensions_SelectionChanged" ItemTemplate="{StaticResource combSizeTemplate}" Canvas.Left="60" Canvas.Top="28.957"  x:Name="comboBoxDimensions" Width="98" Height="21.277" />
            <Label Canvas.Left="54" Content="Dimensions" Canvas.Top="10"  Name="label1"  Width="65" />
            <Label Canvas.Left="55" Content="Metrics" Canvas.Top="73"  Name="label4" Width="45"  />
        </Canvas>
            <Expander.Header>
                <Button Width="100" HorizontalContentAlignment="Center" Click="Expand" Content="Filters" />
            </Expander.Header>
        </Expander>
 
    <ListBox Background="LightGray" Panel.ZIndex="0" Margin="0,15,0,0" ScrollViewer.CanContentScroll="False" ItemTemplate="{StaticResource listbTemplate}" Canvas.Left="15" Canvas.Top="236.232" BorderBrush="Transparent" Height="230" x:Name="dimensionsSelected" Width="130" />
    <ListBox Background="LightGray" Panel.ZIndex="0" Margin="0,15,0,0" ScrollViewer.CanContentScroll="False" ItemTemplate="{StaticResource listbTemplate}" Canvas.Left="162" Canvas.Top="237.75" BorderBrush="Transparent" Height="230" x:Name="metricsSelected" Width="130" />
    <ListBox Background="LightGray" Panel.ZIndex="0" Margin="0,15,0,0" ScrollViewer.CanContentScroll="False" Canvas.Left="311" ItemTemplate="{StaticResource defaultString}" Canvas.Top="238.539" BorderBrush="Transparent" Height="227.693" x:Name="activeFilters" Width="249" />
    
    <Button FontWeight="Bold" MouseEnter="ExecuteButton_MouseEnter" MouseLeave="ExecuteButton_MouseLeave" x:Name="ExecuteButton" Height="24" Click="ExecuteButton_Click" Content="Execute"  Width="60"
    Canvas.Left="510" Canvas.Top="524"/>
    <Button x:Name="CancelButton" Height="24" Click="CancelButton_Click" Content="Cancel" Width="60"
    Canvas.Left="413" Canvas.Top="524"/>
        <Custom:NotifyError Panel.ZIndex="10" x:Name="MainNotify" Canvas.Left="280" Canvas.Top="424" ErrorMessage="" Visibility="Collapsed" />
    </Canvas>
</Window>
